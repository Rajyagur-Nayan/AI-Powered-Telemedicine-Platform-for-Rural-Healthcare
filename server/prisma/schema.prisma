// 1. Define the database connection
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ===============================
// ENUMS
// ===============================

enum Role {
  PATIENT
  DOCTOR
  ADMIN
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum MedicineType {
  PILL
  SYRUP
  INJECTION
  OTHER
}

enum LogStatus {
  TAKEN
  MISSED
  SKIPPED
}

// ===============================
// USERS
// ===============================

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  role      Role     @default(PATIENT)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  doctorProfile   DoctorProfile?
  patientProfile  PatientProfile?
  notifications   Notification[]
}

// ===============================
// PROFILES
// ===============================

model DoctorProfile {
  id              Int     @id @default(autoincrement())
  userId          Int     @unique
  user            User    @relation(fields: [userId], references: [id])

  specialization  String?
  experience      Int?
  bio             String?
  consultationFee Float?
  isAvailable     Boolean @default(true)

  // Relations
  appointments    Appointment[]
  prescriptions   Prescription[]
}

model PatientProfile {
  id        Int    @id @default(autoincrement())
  userId    Int    @unique
  user      User   @relation(fields: [userId], references: [id])

  age       Int?
  gender    String?
  address   String?

  // Relations
  appointments      Appointment[]
  medicalRecords    MedicalRecord[]
  aiAssessments     AIAssessment[]
  prescriptions     Prescription[]
  medicineSchedules MedicineSchedule[]
}

// ===============================
// TELEMEDICINE MODULE
// ===============================

model Appointment {
  id        Int               @id @default(autoincrement())
  doctorId  Int
  patientId Int

  doctor    DoctorProfile     @relation(fields: [doctorId], references: [id])
  patient   PatientProfile    @relation(fields: [patientId], references: [id])

  dateTime  DateTime
  status    AppointmentStatus @default(PENDING)
  notes     String?

  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
}

model MedicalRecord {
  id          Int      @id @default(autoincrement())
  patientId   Int
  patient     PatientProfile @relation(fields: [patientId], references: [id])

  title       String
  description String?
  fileUrl     String?  // URL of the uploaded file (image/pdf)
  date        DateTime @default(now())
}

model AIAssessment {
  id          Int      @id @default(autoincrement())
  patientId   Int
  patient     PatientProfile @relation(fields: [patientId], references: [id])

  symptoms    String
  aiDiagnosis String
  confidence  Float?
  createdAt   DateTime @default(now())
}

// ===============================
// PRESCRIPTIONS & MEDICINE
// ===============================

model Prescription {
  id        Int    @id @default(autoincrement())
  doctorId  Int
  patientId Int

  doctor    DoctorProfile  @relation(fields: [doctorId], references: [id])
  patient   PatientProfile @relation(fields: [patientId], references: [id])

  diagnosis String?
  notes     String?
  issuedAt  DateTime @default(now())

  medicines PrescriptionItem[]
}

model PrescriptionItem {
  id             Int          @id @default(autoincrement())
  prescriptionId Int
  prescription   Prescription @relation(fields: [prescriptionId], references: [id])

  medicineName   String
  dosage         String
  frequency      String
  durationDays   Int
}

model MedicineSchedule {
  id            Int          @id @default(autoincrement())
  patientId     Int
  patient       PatientProfile @relation(fields: [patientId], references: [id])

  medicineName  String
  type          MedicineType @default(PILL)
  dosage        String

  isMorning     Boolean      @default(true)
  isAfternoon   Boolean      @default(false)
  isEvening     Boolean      @default(true)
  isNight       Boolean      @default(false)

  isAfterFood   Boolean      @default(true)
  isActive      Boolean      @default(true)

  logs          MedicineLog[]
}

model MedicineLog {
  id           Int             @id @default(autoincrement())
  scheduleId   Int
  schedule     MedicineSchedule @relation(fields: [scheduleId], references: [id])

  takenAt      DateTime        @default(now())
  scheduledFor DateTime
  status       LogStatus
}

// ===============================
// NOTIFICATIONS
// ===============================

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])

  title     String
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}
